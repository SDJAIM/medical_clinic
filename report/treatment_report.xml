<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Treatment Report -->
    <report
        id="action_report_treatment"
        model="clinic.treatment"
        string="Treatment Summary"
        report_type="qweb-pdf"
        name="medical_clinic.report_treatment_document"
        file="medical_clinic.report_treatment_document"
        print_report_name="'Treatment - %s' % (object.treatment_code)"
    />
    
    <template id="report_treatment_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="web.external_layout">
                    <div class="page">
                        <h2>Treatment Summary</h2>
                        <div class="row mt-4">
                            <div class="col-6">
                                <strong>Treatment #:</strong> <span t-field="doc.treatment_code"/><br/>
                                <strong>Date:</strong> <span t-field="doc.date" t-options='{"widget": "date"}'/><br/>
                                <strong>Type:</strong> <span t-field="doc.treatment_type"/>
                            </div>
                            <div class="col-6">
                                <strong>Patient:</strong> <span t-field="doc.patient_id.full_name"/><br/>
                                <strong>DOB:</strong> <span t-field="doc.patient_id.date_of_birth"/><br/>
                                <strong>Doctor:</strong> <span t-field="doc.doctor_id.name"/>
                            </div>
                        </div>
                        
                        <h3 class="mt-4">Chief Complaint</h3>
                        <p t-field="doc.chief_complaint"/>
                        
                        <t t-if="doc.physical_examination">
                            <h3 class="mt-4">Physical Examination</h3>
                            <p t-field="doc.physical_examination"/>
                        </t>
                        
                        <t t-if="doc.diagnosis_ids">
                            <h3 class="mt-4">Diagnosis</h3>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Diagnosis</th>
                                        <th>ICD Code</th>
                                        <th>Notes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="doc.diagnosis_ids" t-as="diag">
                                        <tr>
                                            <td><span t-field="diag.diagnosis"/></td>
                                            <td><span t-field="diag.icd_code"/></td>
                                            <td><span t-field="diag.notes"/></td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>
                        
                        <t t-if="doc.prescription_ids">
                            <h3 class="mt-4">Prescriptions</h3>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Medicine</th>
                                        <th>Dosage</th>
                                        <th>Frequency</th>
                                        <th>Duration</th>
                                        <th>Instructions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="doc.prescription_ids" t-as="rx">
                                        <tr>
                                            <td><span t-field="rx.medicine_id.name"/></td>
                                            <td><span t-field="rx.dosage"/></td>
                                            <td><span t-field="rx.frequency"/></td>
                                            <td><span t-field="rx.duration"/> days</td>
                                            <td><span t-field="rx.instructions"/></td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>
                        
                        <t t-if="doc.follow_up_date">
                            <h3 class="mt-4">Follow-up</h3>
                            <p><strong>Date:</strong> <span t-field="doc.follow_up_date"/></p>
                            <p t-field="doc.follow_up_notes"/>
                        </t>
                        
                        <div class="mt-5 text-center">
                            <div class="row">
                                <div class="col-6 offset-3">
                                    <hr/>
                                    <span t-field="doc.doctor_id.name"/><br/>
                                    <span t-field="doc.doctor_id.medical_specialization"/><br/>
                                    License: <span t-field="doc.doctor_id.license_number"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>
    
    <!-- Prescription Report -->
    <report
        id="action_report_prescription"
        model="clinic.treatment"
        string="Prescription"
        report_type="qweb-pdf"
        name="medical_clinic.report_prescription_document"
        file="medical_clinic.report_prescription_document"
        print_report_name="'Prescription - %s' % (object.patient_id.full_name)"
    />
    
    <template id="report_prescription_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="web.external_layout">
                    <div class="page">
                        <h2 class="text-center">PRESCRIPTION</h2>
                        <div class="row mt-4">
                            <div class="col-6">
                                <strong>Patient:</strong> <span t-field="doc.patient_id.full_name"/><br/>
                                <strong>Age:</strong> <span t-field="doc.patient_id.age"/> years<br/>
                                <strong>Gender:</strong> <span t-field="doc.patient_id.gender"/>
                            </div>
                            <div class="col-6 text-end">
                                <strong>Date:</strong> <span t-field="doc.date" t-options='{"widget": "date"}'/><br/>
                                <strong>Prescription #:</strong> <span t-field="doc.treatment_code"/>
                            </div>
                        </div>
                        
                        <div class="mt-5">
                            <h4>Rx</h4>
                            <t t-foreach="doc.prescription_ids" t-as="rx">
                                <div class="mb-3" style="border-left: 3px solid #007bff; padding-left: 15px;">
                                    <h5><span t-field="rx.medicine_id.name"/></h5>
                                    <p class="mb-1"><strong>Dosage:</strong> <span t-field="rx.dosage"/></p>
                                    <p class="mb-1"><strong>Frequency:</strong> <span t-field="rx.frequency"/></p>
                                    <p class="mb-1"><strong>Duration:</strong> <span t-field="rx.duration"/> days</p>
                                    <p class="mb-1"><strong>Quantity:</strong> <span t-field="rx.quantity"/></p>
                                    <t t-if="rx.instructions">
                                        <p class="mb-1"><strong>Instructions:</strong> <span t-field="rx.instructions"/></p>
                                    </t>
                                </div>
                            </t>
                        </div>
                        
                        <div class="mt-5 text-center">
                            <div class="row">
                                <div class="col-6 offset-3">
                                    <hr/>
                                    <span t-field="doc.doctor_id.name"/><br/>
                                    <span t-field="doc.doctor_id.medical_specialization"/><br/>
                                    License: <span t-field="doc.doctor_id.license_number"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>
</odoo>